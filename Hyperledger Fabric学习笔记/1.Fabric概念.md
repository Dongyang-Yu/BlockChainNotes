> Fabric是一个许可的基于商业的区块链构架(permissioned blockchain infrastructure)。主要解决商业性的区块链需求。首先，所有节点都会有一个共享账本，它会把商业的合约、合同封装起来，放在账本里，根据条件自动触发信息，没有人为操作步骤，能保证公平公正性。其次是，隐私性。联盟链有不同的角色不同的权限，不同的角色操作不同的数据，隐私性功能可以及时保护数据。其三，是信任机制更好。各个节点之间，无需身份确认，即可建立信任关系。
>
> Fabric的主要包括三大部分，第一个是Membership,主要是证书的颁发和验证。再一个是Blockchain服务，包括账本交易的处理。最后一部分就是Chaincode，智能合约，负责合同执行脚本，所有的账本都通过Chaincode执行。
>
> 其实，Fabric是商业业务网络的开源框架实现，其中成员身份和角色为其他成员所知。借助容器技术，它允许账本数据库，共识机制和成员服务等组件即插即用。

# Fabric核心概念

* chaincode（链码）：智能合约，智能合约是运行在区块链上的模块化、可重用的<u>自动执行脚本</u>，有了它我们就可以完成复杂的业务逻辑，例如同一个区块链上有多份合约，而每份合约可以约定不同的参与者（企业或者相关方）。也可以指定每份合约里每个子命令做一批特定的事，大家可以把它想象成关系数据库里的事务。如下图所示，我们可以在合约里指定允许哪些企业的节点可以参与到交易流程中来（在fabric里这叫共识策略）。
  ![image-20210113103330836](Fabric%E6%A6%82%E5%BF%B5.assets/image-20210113103330836.png)

* transaction：交易，每条指令都是一条交易。
* world state：世界状态，为了提升性能用的。比如，key1共交易了10000次，为了获取它的当前状态值，需要正向执行这10000次交易，这就得不偿失了。如果这1万次交易里，每次新交易执行完，都同步更新一个数据库（在fabric里用的是levelDB），这样查询当前状态时，只需要查询该数据库即可。

* endorse：背书（在支票背面签名）。金融上：指持票人为将票据权利转让给他人或者将一定的票据权利授予他人行使，而在票据背面记载有关事项并签章的行为。通常引申为对某个事情负责。在我们的共识机制的投票环节里，背书意味着<u>参与投票</u>。

* endorsement policy：背书策略。由智能合约chaincode选择哪些peer节点参与到背书环节来。
* peer：存放区块链数据的节点。
* channel：通道。私有的子网络，事实上是为了隔离不同的应用，一个channel可含有一批chaincode。

* PKI（public key infrastructure），一种遵循标准的利用公钥加密技术为电子商务的开展提供一套安全基础平台的技术和规范。
* MSP（membership service provider）：成员服务提供者，联盟链成员的证书管理，它定义了哪些RCA以及ICA在链里是可信任的，包括定义了channel上的合作者。
* org（organization），管理一系列合作企业的组织。

* CA（Certificate Authority）权威机构负责向用户（包括服务提供者与使用者）提供数字证书，包括公钥与私钥，同时CA机构还需要提供一个CRL（Certificate Revocation List）证书吊销列表。
  ![image-20210112093042490](Fabric%E6%A6%82%E5%BF%B5.assets/image-20210112093042490.png)

# Hyperledger Fabric介绍

Hyperledger项目是由Linux基金会于2015年创建的，以推进跨行业的区块链技术。Fabric是超级账本中的区块链项目之一。和其他区块链技术一样，它有一个账本，使用智能合约，是一个参与者管理交易的系统。

但是，Fabric是私有许可网络，与允许匿名参与网络的开发无许可系统（如基于PoW工作量证明共识算法的比特币网络）不同，Fabric网络成员通过一个受信任的成员服务提供者（Membership Service Provider）来注册。

Hyperledger Fabric 还提供了创建 **通道（Channel）** 的功能，支持构成通道的一组参与者创建<u>不同于通道外成员的交易账本</u>。对于某些网络而言，这是一个特别重要的选项。这些网络中，一些参与者可能是竞争对手，<u>并且不希望他们做出的每笔交易被每个参与者知晓</u>， 例如，他们向某些特定参与者提供的特殊价格。如果两个参与者组成一个通道，那么这两个参与者就拥有该通道的账本副本，而其他参与者没有。

## 智能合约

> 通俗来说，它就是业务逻辑。
> 智能合约就是双方在区块链资产上交易时，触发执行的一段代码，这段代码就是智能合约。“智能合约程序不只是一个可以自动执行的计算机程序，它本身就是一个系统参与者，对接收到的信息进行回应，可以接收和储存价值，也可以向外发送信息和价值。这个程序就像一个可以被信任的人，可以临时保管资产，总是按照事先的规则执行操作。”

简单的来说就是，你可以提前规定好合约的内容，当在满足触发合约条件的时候，程序就会自动执行合约内容。

为了支持信息的一致更新，并实现一整套账本功能(交易、查询等)，区块链网络使用智能合约提供对账本的受控访问。

智能合约不仅是封装信息并使其在整个网络中保持简单的关键机制，还可以编写智能合约以允许参与者<u>自动执行事务的某些方面</u>。

> 例如，可以编写一个智能合约来规定运输物品的成本，运输费用根据物品到达的速度而变化。在双方同意并写入账本的条款下，当收到item时，相应的资金会自动转手。



## 共识 Consensus

> 使帐本交易在网络上保持同步的过程——确保只有当交易得到适当参与者的批准时，帐本才会更新，并且当帐本更新时，它们会以相同的顺序更新相同的交易——被称为共识。

交易必须按照发生的顺序写在账本上，即使它们可能位于网络中不同的参与者之间。为了做到这一点，必须建立交易的顺序，且必须采用一种方法来拒绝错误（或恶意）插入到账本中的错误交易。

# Fabric新架构

Fabric为事务引入了一个新的架构，我们称之为execute-order-validate。
它通过将事务流分离为三个步骤，解决了order-execute模型所面临的弹性、灵活性、可伸缩性、性能和机密性挑战:

* **执行**一个事务并检查它的正确性，从而认可（endorse）它，
* 通过(可插拔的)共识协议对事务进行**排序**
* 在将事务提交到账本之前，根据特定于应用程序的背书策略（endorsement policy）**验证**事务

Hyperledger Fabric与其他区块链系统的区别在于它是私有的和被允许的。与允许未知身份参与网络的开放无许可系统不同(需要像“工作证明”这样的协议来验证交易并保护网络)，Hyperledger Fabric网络的成员通过可信的**会员服务提供商**Membership Service Provider(MSP)注册。

Hyperledger Fabric还提供了创建通道的能力，允许一组参与者创建单独的交易账本。对于网络来说，这是一个特别重要的选择，因为有些参与者可能是竞争对手，而不希望他们所做的每一笔交易——例如，他们向一些参与者提供一个特别的价格，而不是其他人——让每个参与者都知道。如果两个参与者组成一个通道，那么这些参与者——而不是其他参与者——拥有该通道的分类账副本。

Hyperledger Fabric有一个包含两个组件的帐本子系统：the **world state**世界状态和the **transaction log**事务日志。每个参与者在他们所属的每个Fabric网络上都有一份账本的副本。

* 世界状态组件描述帐本在给定时间点的状态。这是账本的<u>数据库</u>。
* 事务日志组件记录所有导致当前世界状态值的事务;这是世界状态的更新历史。因此，帐本是世界状态数据库和事务日志历史记录的组合。
* 帐本有一个可替换的世界状态数据存储。默认情况下，这是一个LevelDB键值存储数据库。事务日志并不需要是可插入的。它只是简单地记录了区块链网络使用的帐本数据库的前后值。



# 参考

Fabric概念解释：https://blog.csdn.net/qq_36336522/article/details/84189599

